# [Observability Engineering](https://www.oreilly.co.jp/books/9784814400126/)

## 第１部：オブザーバビリティへの道

### １章：オブザーバビリティとは？

- オブザーバビリティの意味
  - 制御理論での原義的には、外部出力の知識からシステムの内部状態をどれだけ推測できるかの尺度
  - ソフトウェアシステムの「オブザーバビリティ」：システムがどんな状態でも、その状態をどれだけ理解し説明できるかの尺度
- オブザーバビリティによってできること
  - アプリケーションの内部構造を理解できる
  - 未知の出来事に対しても、アプリケーションがどのようなシステム状態に陥っているか理解できる
  - 外部ツールを通じて観測、調査することで、内部動作とシステム状態を理解する
  - 新たにコードを改修することなく、内部状態を理解できる
- システムがオブザーバビリティを備えているかどうかの問いかけ
  - 任意のユーザーが任意の時間に体験していることを理解できるか？
  - あるユーザーリクエストに疑わしい属性を見つけた時、全てのユーザーを検索して類似のパターンを特定し、疑念を検証できるか？
  - これらの問題に、シームレスに考えを巡らせながら探索的に検証できるか？など
- **新しいコードをデプロイすることなく、システムのどんな斬新な状態も理解できるなら、オブザーバビリティがあると言える**
- オブザーバビリティが必要な理由
  - モニタリングは主に既知の障害モードを想定しており、ソフトウェア開発者はシステムの状態を完全には捉えられない
  - 最近のシステムの実態を把握するには、既存のモニタリングは不十分
	- インフラは動的かつスケーラブルであり、サービスやデータストアが多数存在する
	- ソフトウェアエンジニアは本番環境のコードのオーナーであり、主体的に計装を行い、新しい変更がデプロイされるときにパフォーマンスを検査する動機がある
	- 信頼性の焦点は、エラーバジェットやサービスレベルを利用して、継続的な劣化にどう耐えるかに置かれている
	- 相関関係の検証は、実質的に無制限のディメンジョンの間で行われる
  - モニタリングは既知の未知を扱うが、オブザーバビリティは未知の未知を扱う
- オブザーバビリティの柱：高いカーディナリティ、高いディメンジョン、探索可能性  
  - システムの把握に際して、高いカーディナリティの情報は非常に役に立つ
  - データに豊富なディメンジョンを用意することで、アプリケーションの状態をより精緻に捉えることができる
  - システムの探索可能性：システムが陥った状態に対して、反復的な調査によって最終的な理解が得られること

### ２章：オブザーバビリティとモニタリングにおけるデバック方法の違い

- メトリクスに基づいてシステムの洞察を得ることは、本質的にリアクティブであり、探しているものを事前に宣言する能力によって制限される
- 「多くのチームは、カスタムメトリクスに熱中し、請求書を見て愕然とし、結局その大部分を削除することになるのです」
- オブザーバビリティがあれば、問題がどのように起きているかをディメンジョンの組み合わせによって探索し、原因を発見できる
- 客観的かつ方法論に基づいた調査に注力することで、チーム全体が本番環境の問題を診断する自信にもつながる
- オブザーバビリティツールは、テレメトリーデータから高カーディナリティ、高ディメンジョンのコンテキストを集め、調査者が柔軟に分析できるようにする

### ３章：オブザーバビリティを用いないスケーリングからの教訓

- Parse の事例：その都度最適な技術的選択をしていても、サービスや事業状況の非連続的な変化にシステムが対応しきれないことがある
- モノリス時代の監視ツール（TSDB やログ管理、アラート管理）は、予測可能性が支配している時代のために作られており、マイクロサービスシステムにおけるさまざまな振る舞いの原因を捉えきれない
- システムアーキテクチャの現代化：あらゆるものの分割、多様なデータストア、マイクロサービス化、コンテナやサーバーレスなどエフェメラルでエラスティックなインフラリソースの多用
- システムの分散化に伴う二次的効果：可用性の定義の複雑化、漸進的デリバリー、機能フラグによるコードのデプロイと機能リリースの分離、監視対象における未知の症状の増加
- 分散システムでは、ステージング環境によって本番環境を再現することの難しさも増している。ステージングにおけるデバッグや検査の有用性が薄れている
- 分散システムへの移行における運用プラクティスの変化
  - アラートはユーザー体験に直結するものに焦点を当て、ノイズを抑えていく傾向へ
  - 手順書で対応できるような既知の問題は自律的解決に移行し、エンジニアが対応するべきサービス障害は自動復旧ができない未知の症状となる

### ４章：オブザーバビリティと DevOps、SRE、クラウドネイティブとの関連性

- モノリス時代の監視では、システムコンポーネントの関係を頭に入れておく必要があった。分散トレースによって個々のステップを分解して可視化できれば、特定リクエストの実行に影響を与える要素を理解するだけで良くなる。オブザーバビリティはチームが合理的にデバッグを行うための共有コンテキストを提供する
- DevOps チームや SRE チームはユーザーの苦痛に直結した症状の測定を目指す。症状ベースのモニタリングには、実際の故障を的確に説明する能力が必要となる。
- オブザーバビリティは、DevOps や SRE が実践するようなエンジニアリングプラクティスにも効果的なデータを与える
  - カオスエンジニアリングと継続的検証：システムの基本状態を把握し、カオス注入時の動作や逸脱を説明する能力のために、オブザーバビリティが有用となる
  - 機能フラグ：本番環境において、各機能フラグがユーザーに与える個別的、総合的な影響を把握するためにオブザーバビリティが有用となる
  - 漸進的リリース：システムの振る舞いとリリースの因果関係を効果的に把握するために、オブザーバビリティが有用となる
  - インシデント分析とポストモーテム：事後的な証跡と、振り返り作業者の手がかりを適切に提供するために、オブザーバビリティが有用となる
