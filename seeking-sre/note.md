# [Seeking SRE](https://www.oreilly.co.jp/books/9784873119618/)

## 第１部：SRE の導入

- 自分が SRE であることを自覚するのは：最初の質問として「それをどのように計測していますか」が口をついて出る時。自分の語彙から「非難する」という言葉を消し去る時


### １章：SRE におけるコンテキストとコントロール

- Netflix におけるコンテキストの例：「ドメインの懸念事項については明示的な優先順位づけを行なっていくが、信頼性を犠牲にするよりは実行効率の低さを選ぶ必要がある」という方針を周知徹底した

### ２章：サイトリライアビリティエンジニアの面接

- 暫定の候補者像は例えば、期待される知識、経験、成長パス、リーダーシップのスキルが含まれていると適切なものにしやすい
- チームが候補者に求めるものがわかると、それを評価するための質問も検討できる
- 社内文化への適合性は、組織の規模や構造によっては、技術面の弱みを相殺する場合もある。こうした内容は、候補者が仕事に取り組むスタイルに分け入る質問によって判断できる
- 在宅回答課題は、より現実的に即したシナリオでソフトウェアを描く能力を示すことができる。一方で候補者も評価者も多くの時間を割く必要があるので、最初のオンサイト面接でシグナルが得られなかった側面を確認するための手段と考えるのが良い
- 採用を断念するのは難しい判断だが、長い目で見れば採用で間違った選択をする方がほぼ必ず、より悪い結果となる
- 面接の成績に基づいて不採用に決定する場合であっても、候補者が「プロセスは公平だったし良い経験をした」と感じながら面接を終えられるように心がける

### ３章：なるほど、SRE チームを作りたいのですね

- SRE と開発チームのペアワークで、プロダクション運用に積極的に参加していくのは良さそう
- 開発と SRE の間での人事ローテーションプログラムや、開発チームと SRE チームの間を誰でも自由に移動できるポリシーは試してみると良いかもしれない
- 誰かのレビューが悪い情報ばかりだったものの、グループの反応は助力的だった場合、そうした社内文化は SRE にふさわしいと言える
- 組織がローンチ（新しく魅力的に見えるツールなど）だけでなくランディング（プロダクションの自動化がもたらす計測可能な節約）に報いているのは、組織が成熟している兆候の一つである
- SRE とは実際には、他のビジネス目標の足を引っ張ることが内容に信頼性を管理すること
- 信頼性より重要な目標としては、テクノロジーがビジネスの差別化要因となるタイミングや領域で、確実に成果を上げること
  - こうしたケースでは、製品開発チームに全速力で突っ走らせたいと思うので、SRE チームはガードレールを提供することは価値になる（例えばカナリアサーバーによる容易なロールバックを提供するなど）

### ４章：インシデントのメトリクスを用いた SRE の大規模な改善

- デプロイ、モニタ、改善、コードの好循環を作ることで、サービス障害からの学習の適切性、バグ修正の迅速性を把握できるようになる
- インシデントのメトリクスとしては、検出時間、エンゲージ時間、修正時間のそれぞれを改善する必要がある
  - 検出時間：自動のモニタリングとアラートによって改善
  - エンゲージ時間：自動化されたエスカレーションとプロセスで改善
  - 修正時間：高速ロールバック、フェイルオーバー、前方修正で対応
  - 他に、各メトリクスに関連して具体的なアクションに繋がりやすい代理メトリクス（例えば自動検出された割合や、関わったエンジニア数など）を検討・利用することも有効
- 修復負債には短期（1週間程度でロールアウトできる修正）と長期（コードのより徹底した修正などやデリバリツールの構築など、根本的な修正）のものがある。これらを開発アイテムとして管理し、エラーバジェットなどと組み合わせることで効果的なシステム改善が可能になる。
- 仮想修復負債（改善管理から漏れている修復アイテム）があると、特定の TTD, TTM の欠落が繰り返し発生することになる。ダッシュボードなどによる管理が必要
- 重要なメトリクスがわかるまでは、多くのデータを手作業で検討することも必要となり得る（Azure でもそうなのは安心）

### ５章：サードパーティとの協力を円滑に進める重要性

- 統合の重要性を早い段階で判断しておくと、将来生じる技術的負債やスケーリングの制約を回避するのに役立つ
- 早い段階でステークホルダーを特定して意見を求めるほど、所有権を適用し、プロジェクトに追加の人員を確保するのが容易になる
- ソリューションの選択には（フル自前）構築、（外部サービスの）購入、（OSS の）採用が考えられる。それぞれに導入コストと運用コストがある
- プロジェクトに取り組む際の考慮事項：解決しようとしている問題、最終損益への影響、運用実績、リスクやメリット、成功・失敗の計測方法など
- 依存するサードパーティがダウンすれば自社もダウンし得る。認証や CDN など。
- 依存するサードパーティサービスのパフォーマンスやサービスレベルを計測できるかも考慮する必要がある（Cloudflare, Auth0 はそこそこ把握しやすい印象）
- サードパーティは補助的な存在ではなく、自社の技術スタックの拡張である。それがクリティカルパスであるなら、サービスと同様に扱う必要がある

### ６章：専任 SRE チームなしで SRE の原則を適用する方法

- （SoundCloud の例では）派遣された SRE は無視されるか、また別のバックエンドエンジニアとして扱われるだけで、SRE と協力することが信頼性や生産性を改善する機会になるとは認識してもらえませんでした
- 多くのチームに自身のサービスに関するオンコール義務を渡すようにした
  - 各チームが運用上の負担を引き受ける最大のインセンティブは自律性だった
- オンコールの経験がないエンジニアでも無理なく対応できるように、対話型学習ワークショップのシリーズを開発した
- SysOps チームとプラットフォームチームを合併し、プロダクションエンジニアリングチームとした。
- 少数のエキスパートでローテーションを組む落とし穴：一人当たりの負荷が高まる。騒々しいページに対する許容度が高くなる。明文化やわかりやすいアラート作成の優先度が下がる。
- 複数の小さなチームのオンコールのローテーションを一つに合併し、基本原則も文書化した
  - 原因ベースのアラートは、現実の差し迫った問題と非常に強い相関があるのでなければ除外される傾向にある
  - 文書化が不十分か問題が複雑な場合には、サービスを所有するチームにインシデントをエスカレーションできる
- ポストモーテムはエンジニアリング組織横断のチームがレビューすることで品質を担保できると良いかもしれない
- すでに確立されている組織に SRE の原則を導入するときには、エンジニア個人にどうインセンティブを与えるかに先立ってまず、さまざまなレベルの経営・管理層からどのように賛同を得るかという課題に直面する
- 変化を後押しするインセンティブの構造がなければ、変化を起こすのは不可能
- 包括的なモニタリング、ノイズの少ないアラート、運用の適切な文書化でワークロードを軽減すれば、運用の負担を別のチームに押し付けなくても機能をリリースできる

### ７章：SRE のいない SRE：Spotify のケーススタディ

- 草創期の学び
  - 最初から運用エンジニアをチームの一員に加えたことで、エンジニアリング文化に良い影響を与えた
  - 運用重視の考え方は、早い段階からエンジニアリング文化に取り入れる必要がある
  - ビジネスロジックのアーキテクチャとは別に、インフラのアーキテクチャもできるだけ早い段階で確立することが重要
- ベータとリリース期の学び
  - 運用をソリューションのライフサイクルに組み込む、スケーラビリティや信頼性、保守性など運用上の品質には早い段階から議論しておく
  - エンジニアを信頼し、特権アクセスを必要なメンバー全員に与えることで、高速なイテレーションを阻害せずに済んだ
- コアサービスを定義することで、夜間業務の負担が軽減され、健全な形で意思決定を行えるようになった（CUJ と相性が良さそう）
- 運用エンジニアからシフト制のゴールキーパーを配置することで、コンテキストスイッチや知識のサイロ化を防いだ
- 探偵の養成：CUJ に関する全てのバックエンドシステムに触れるシナリオを順に辿ることで、教えたり学ぶことが簡単になる。エンジニアのオンボーディングにも有効。
- スケール時の学び
  - 運用を最初から真にデフォルトとする。自分で構築したものは自分で実行および運用する
  - 運用の責任をそのノウハウがあるところ、つまり開発者の近くに移す
  - サービスのエコシステムがスケールするに伴って、運用業務をスケールさせる方法も見直すようにする
- 開発者と運用担当者のギルドで、サービスレベルを定義するための標準化された方法やオンコール・インシデント対応の短期集中コース、キャパシティプランニングに関するガイダンスなどを議論した
- 運用の責任を開発チームに移行していくために、効果的なツールを整備するための大規模な投資、フレームワークの記述と奨励、ドキュメンテーションの作成を実施した
- 機能チームへの運用エンジニアの派遣とナレッジ転移は、embed SRE っぽい
  - 「組織内で運用をデフォルトとするためには、コラボレーションを通じて運用を教えることが非常に重要」
- ゴールデンパスや公認スタックを適切にサポートすることで、開発分隊が機能開発に集中できるようになる。ただし、制限が強すぎると分隊の自律性と実験的試みを損なうリスクもある

### ８章：大企業における SRE の導入

- SRE を企業に導入するために用いたステップ：現状の定義、ステークホルダーの特定と教育、ビジネスケースの作成と提示、SRE チームの編成、結果の計測
- 開発サイクル全体を通じた SRE の関与とメリット
  - 設計：設計上の選択がプロダクション展開後の運用に及ぼす影響に関する将来の論争リスクを最小化
  - 構築：リリースに先立って SRE が運用経験を蓄積
  - リリース：運用の負担を抑制、ローンチ後もエンジニアリングの開発意欲を維持
  - リリース後対応：プロダクションに関する責任の明確な所有権を確立
- 組織に SRE を導入するプロセスを通じて得た教訓
  - 現状維持に挑戦する、組織構造の理解に時間をかける、ビジネスケースの構造に基づいて SRE 導入の枠組みを構築する、境界と焦点を設定する。

### ９章：25ページでシステム管理者から SRE へ

- SRE はサービスのユースケースを理解し、その重要な側面を特定して、サービスレベルを確立、および調整する
  - Amazon の「[リーダーシッププリンシプル](https://www.aboutamazon.jp/about-us/leadership-principles)」における「Customer Obsession - リーダーはカスタマーを起点に考え行動します」
  - Google の「[10の事実](https://about.google/philosophy/?hl=ja)」における「ユーザーに焦点を当てれば、他のものは皆後からついてくる」
- SLI の数はできるだけ最小限に抑えるという傾向があるものの、SLI の最終的なリストはユーザーの主要な必要性を全てカバーする必要がある
- 内部コンポーネントについて個別にサービスレベルを確立することは、コンポーネント間の関係を明確にし、そのやりとりを正確に調整するのに役立つ
- コンポーネントのパフォーマンスがそれ自体のパフォーマンスやキャパシティだけでなく、外部依存関係の能力によっても制限されることは念頭におく必要がある
- サービスレベルがなければ、サービスの状況の判断基準となるのは誰かが苦情を申し立てるような問題しかない。実際にはエンドユーザーが後味の悪さを感じながら黙って立ち去ってしまったケースがあるかもしれない
- サービスレベルはユーザーとのアグリーメントであるだけでなく、開発者、SRE、管理層の間のアグリーメントでもあり、全員がこの可用性レベルをサポートするために取り組む
- スタートアップ企業など新機能リリースの優先度が高い場合などは、サービスレベルの期待を修正することが発生しやすい
- 高いサービスレベルが必要ないプロジェクトでは、必ずしも SRE を配属する必要はない。SRE と開発者が同じ可用性目標を共有することが大事

### 10章：大企業で SRE 導入の道を開く方法

- トイルが多い弊害：達成感がない、燃え尽き、エラーが増えやり直しに時間が取られる、新たなスキルを学ぶ時間が得られない、など
- 組織の境界を超えた作業が難しいのは、サイロ効果、リクエストキュー、チケットなどが複合的な効果を及ぼしているから
- サイロ化したグループ間の作業引き継ぎでは、情報、プロセス、使用ツール、キャパシティのミスマッチが起こる
- 運用のコンテキストにおける「カタ」プロセス：方向性・課題を明らかにする、現状を把握する、次のターゲット条件を確立する、ターゲット条件に向けて実践する
  - プロセス振り返りセッションでは、特定のプロセスについて直接の知識があるメンバーを集めて情報を引き出し、視覚的な分析を行う
- システムを構築、または改善するようなエンジニアリング作業は資産価値を高めるため、CapEx（設備投資）となる。一方で OpEx（運用コスト）予算が資金源となって効率性を管理されているチームには、大掛かりなエンジニアリング予算がないことが多い
  - SRE チームを単なる運用チームでなくするには、「SRE チームはエンジニアリング作業を実行するために資金を与えられる必要がある」と主張することが必要になってくる
- 大企業における機能横断型チームと SRE の関わり方
  - SRE をプロダクト専用チームに参加させる：Netflix モデル
  - パフォーマンスと安定性が一定の基準に達したサービスを SRE に引き継ぐ：Google モデル
- 「カタ」プロセスのステップ２（現状の把握）によって作業の流れと組織構造の関係を把握することで、組織構造の変更に関する議論に役立つ
- ネットワーク、プラットフォーム、セキュリティ、データ管理はスペシャリストからなる機能別チームを持つことが避けづらい
  - 引き継ぎが必要な箇所にセルフサービス型の機能をデプロイすることで、必要がある各自で作業を実行できるようになる
- SLO やエラーバジェット、トイルの制限やバックログをうまく使うことで、開発と運用の優先度を効果的に評価できる

### 11章：DevOps の幅広い実践現場で活用されている SRE のパターン

- 「自動化テストがなければ、コードを書けば書くほどコードのテストに必要な時間と資金が増えてしまう」
- （Google のプラクティスでは）運用エンジニアは、サービスがプロダクションレディとなるようにプロダクトチームをサポートするコンサルタントとして機能する必要がある
- ローンチのガイダンスを作成すると、あらゆるプロダクトチームが組織全体、特に運用の集合知の恩恵を受けるのに役立つ
  - ローンチのガイダンスと要件：欠陥のカウントと重要度、ページャーへのアラートのタイプと頻度、モニタリングのカバレッジ、システムアーキテクチャ、デプロイプロセス、プロダクションのハイジーン
  - Google では SRE がプロダクトチームを自発的に支援する← SRE としての他業務との優先度が気になる
- 共有ソースコードリポジトリを作ることで、エンジニアが組織内のあらゆる専門知識を活用できる

### 12章：DevOps と SRE: コミュニティからの声

- SRE は ITIL/ITSM のプロセスを連携させて DevOps へと進化させる取り組みで重要な役割を持つ。実現手段の性格を強める
- 「DevOps とはアジャイルと同じように、それを実践するものが従う哲学、方法論、プラクティスの性格が強い。（中略）SRE の職務はサイトの信頼性を確保すること」わかる。
- 「DevOps エンジニアは SDLC の前半である QA や CI/CD に、SRE はパイプラインの後半であるプロダクション運用に重点を置いている。」開発組織やサービスの成熟度によって、重点の置き方が変わる
- 「DevOps では SDLC において運用よりも開発・リリース側に重点が置かれることが多い、SRE は運用の改善に特に関心がある」分かる
- PayPal では、SRE は DevOps の理想的な実践者として信頼性エンジニアリングを行なっている：プラットフォームプロバイダとしてのツール群の提供、プロダクトチームに派遣されるエキスパートとしての、信頼性機能の提供
- 「DevOps の焦点はプロセスにあり、SRE の焦点はプロダクトにある」なるほど
- 「DevOps が一般的なのはスタートアップで、少しでも早くプロダクションに到達するインセンティブが信頼性より優先する。SRE はすでに確立されたビジネスで、イノベーションと信頼性の矛盾が顕在化し始めた場合に大きな効果を発揮する」：早い段階から SRE が関わろうとするのとは逆行する意見かも

### 13章：Facebook におけるプロダクションエンジニアリング

- フェイスブックにおいて SRE チームは当初 SWE チームとの連携が期待されていたが、実際はソフトウェアの変更や構築をデプロイの段階で知ることが多かった
- フェイスブックにおける SRO (Site Reliability Operations) チームへの期待：サービス障害時の火消し作業を継続すること、そういった取り組みの属人化を防ぐために自動化を進めること
- AppOps という名称から Ops を除いたことによる影響：単なる運用チームではなく、運用の課題をエンジニアリングで解決するチームであることの周知徹底、SWE はサービス運用責任を他に任せられるという概念のリセット
- 運用担当幹部を CEO ではなくエンジニアリング責任者の直下にすることで、運用責任者は他の開発グループと対等になり、エンジニアリング責任者に運用の責任も負ってもらうことができる
- 分散型の派遣モデルでは、PE は SWE に歩み寄り、サービスの信頼性を高める方策や成長の実現に必要な機能について協力して取り組む
- チームに PE を派遣するかは場合による。ライブビデオや汎用ビデオインフラのような逃すべきでないユースケースの場合は、PE が最初から関与する場合もある
- 技術や運用の負債を管理するのは SWE チームの責任としている。開発内で本来のサービスを優先する必要があったり、チームを作るのが合理的であれば PE が引き受けることもある
  - 特定の領域に適性やモチベーションがある PE が開発チームに出張し改善に参加することは、SWER からみても運用の知見が手に入るというメリットがあり、奨励している
- フェイスブックでは、同じチームでの在籍が3年以上となったエンジニアに対しては、新しいチームへの移動を強く働きかける。これによってイノベーションの窒息を防ぐ
- プロダクションエンジニアとして必要な特質：仕事をやり遂げる集中力、協力的なコミュニケーション、技術的な知識とスキル、柔軟性、コラボレーションと妥協、単一障害点にならない意欲
- PE モデルを評価する方法：派遣型のコラボレーションによるオンコールの共有、技術的な信頼性がある強い関係、運用と機能のバランス、機能が豊富で安定したシステム提供への説明責任
- 機能と安定性の問題に関しては、両者痛み分けという感覚が求められる。数ヶ月などの長期的な視点で両者のバランスを取る必要がある

## 第２部：SRE の周辺知識

### 14章：はじめにカオスありき

- 複雑さを減らす代替案：複雑さのナビゲート
- Netflix では各マイクロサービスチームが、弾力性を確保する責任を持つ
- プロダクトの作成やサービスデリバリを悪化させる可能性のある、複雑性の４つの柱：状態、関係、環境、不可逆性
- システムに対する境界は経済、ワークロード、安全性の３つがあるが、安全性の境界は他に比べて把握するのが難しい。Chaos Monkey は安全性のシグナルを提供してくれる
- カオスエンジニアリングに関する一連のプラクティス：[PrinciplesofChaos.org](https://principlesofchaos.org/)
  - システムの定常状態を定義し、対照群と実験群で状態の違いを見る
- 詳細な原則
  - 複雑なシステムは個人が全体像を完全には把握できない。よってどのように機能するかではなく、機能するかどうかに集中する
  - 安全性シグナルを継続的に得るために、継続的に検証を実行する必要がある
  - 影響範囲を局所化する
- ステージングではみられない挙動を本番環境が示す可能性は常にある
- カオスエンジニアリングとはカオスを生み出すのではなく、システムに最初から潜むカオスを露呈させる取り組みである

### 15章：信頼性とプライバシーが交わるところ

- プライバシーはユーザーの期待や信用と深く結びついており、プロバイダがユーザーのデータを偽りなく保護することが求められている
- プライバシーに関する作業の３つのカテゴリ
  - 防護：プロダクトに関するプライバシー上の潜在的な問題を発見して解決する
  - 強化：全てのチームが「正しいことをする」プロダクトを容易に開発できるようにする
  - 消化：プライバシーに関して「火事」が発生した時には、プライバシーエンジニアが消化活動を行う
- プライバシーエンジニアの思考：関係しているデータは何か、データはどこに保存されているか、データには誰が、どのような方法でアクセスしているか、など
- 信頼性とプライバシーのどちらの領域も、「壊れたところを見る」能力が、優れたエンジニアの重要な資質となる
  - トイルの削減：自動化、共有アーキテクチャのデフォルト挙動、フレームワークの利用（RBAC など）
  - 効率的で計画的な問題解決：課題の解決は一度だけ、根本原因の発見と対処
- 信頼性でもプライバシーでも円滑なコミュニケーションで重要となるのは、共有するミッションに集中して、相手には前向きな意図があると信じ、非難しないこと
- プライバシーについて他者を積極的に教育するのは、負荷を分散することにもなる。
- 信頼性は100%でなくてもリリースや復旧ができるが、プライバシーに関するインシデントは永続的な影響を残す可能性がある
