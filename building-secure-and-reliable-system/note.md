# [Building Secure and Reliable System](https://www.oreilly.co.jp/books/9784814400256/)

## 第１部：入門資料

### １章：セキュリティと信頼性が交わるところ

- 信頼性にとっての主要なリスク：ソフトウェアの不適切な更新やデバイスの物理的な故障など、悪意がないもの
- セキュリティにとっての主要なリスク：システムの脆弱性を積極的に悪用しようとする攻撃者によってもたらされる
- セキュリティと信頼性は、どちらもシステムの機密性、完全性、可用性に関係している。二つの視点の大きな違いは、悪意のある攻撃者を想定するか否か
- 信頼性とセキュリティの共通点：効力の不可視性、評価方法、単純さの有用性、システムの進化への対応、弾力性、システムの調査とロギング、危機対応など
- インシデントによって企業のバリュエーションを毀損してしまうのは想像しやすい（Yahoo の事例）
- セキュリティと信頼性には多くの共通点があり、どちらも当初は速度の名の下に犠牲にしたくなるが、何かあってから修正するのはコストがかかる

### ２章：攻撃者に対する理解

- 攻撃者のモチベーション：好奇心、名声、金銭的利益、強制、諜報など
- 攻撃者のプロファイル：ホビイスト、脆弱性研究者、政府及び法執行機関、活動家、犯罪当事者、インサイダーなど
  - 政府機関の中には、軍事目的や国内活動の取り締まりなどさまざまなモチベーションがある
- ハードウェアの詳細や暗号など秘匿性の高い情報を扱うサービスは、攻撃者のターゲットとなり得る
- CAPTCHA システムなどを用いることで、攻撃のコストをあげ、攻撃者からの優先度を下げることができる
- 信頼性と安全性を兼ね備えたシステム設計の際には、ミスを犯すかもしれないインサイダーと、従業員のアカウントを乗っ取るかもしれない攻撃者の両方を考慮するのが良い
- インサイダーリスクは、当事者、動機、行動、標的などに応じたモデル化ができる
- インサイダーリスクの分析に効果的な観点：最小権限、ゼロトラスト、マルチパーティ認可、ビジネス上の正当性、監査と検出、リカバリ可能性
- 攻撃者の手法を学ぶための３つのインテリジェンス：脅威インテリジェンス、サイバーキルチェーン、戦術・技術・手順（TTPs）
  - [ARR&CK フレームワーク](https://attack.mitre.org/)はサイバーキルチェーンの各段階を詳細に説明している

## 第２部：システムの設計

### ３章：ケーススタディ：セーフプロキシ

- セーフプロキシは、許可を受けたものが物理サーバーや特定のアプリケーションにアクセスしたり、変更したりすることを可能にする
- セーフプロキシは Google の [Zero Touch Prod](https://www.usenix.org/conference/srecon19emea/presentation/czapinski) プロジェクトを実現するためのツールの一つ
- クライアントが人間か自動ツールかに関わらず、プロキシを利用することでメリットがある
  - マルチパーティ認可（MPA）
  - 管理者による使用状況の監視
  - レート制御
  - サードパーティによるクローズドソースのターゲットシステムとの互換性
  - 継続的な改善の統合
- 一方で、プロキシには欠点や潜在的な落とし穴もある：メンテナンスや運用のオーバーヘッド、構成によっては単一障害点となり得る、アクセス制御のためのポリシー設定自体がエラーの温床となり得る、など
- プロキシ経由によってリモートアクセスの履歴が残るだけでも、管理上有用そう

### ４章：設計におけるトレードオフ

- プロダクトの機能要件は、セキュリティや信頼性の要件とは大きく異なる特性を示す傾向がある
- 機能要件は、要件と対応するコード、それを検証するためのテストなどと具体的に結びつきやすいが、信頼性やセキュリティなどの非機能要件は直接的に実装やテストするのは難しい場合が多い
- 信頼性やセキュリティは、システムの設計や開発・運用に基づく創発特性と言える
  - 信頼性を創発する要因：マイクロサービスの構成、コンポーネント間の通信の仕組み、オブザーバビリティの仕組み
  - セキュリティを創発する要因：システムコンポーネント間の信頼関係、利用される言語・フレームワーク、セキュリティレビューや監査の仕組み
- Google の設計ドキュメントテンプレート：スケーラビリティ、冗長性と信頼性、依存関係への考慮、データ完全性、セキュリティとプライバシーに関する考慮など
- 出来上がったシステムに後からセキュリティや信頼性の要件を足そうとすると、大幅な設計変更や追加の欠陥が含まれる可能性もある。こうした非機能要件は、設計の初期にセキュリティや SRE チームが関与しつつ、そのコストやリスクについてよく考える必要がある
- 信頼性やセキュリティをカバーするための Google の Web アプリケーションフレームワーク、具体的にどんな内容なのか気になる
- 信頼性やセキュリティの検討を後回しにすれば開発の初期速度は上がるが、開発を継続する上での持続速度が上がらなくなってしまう
  - 信頼性に関しては自動テストや CI/CD パイプライン、ロールアウトやロールバックを柔軟に行うためのインフラを整備することで、持続速度を高めることができる
  - セキュリティについては、関連するクラスの脆弱性に対して構造上安全な（secure-by-construction）防御（？）を提供するフレームワークとワークフローを選択するのが良
- ユーザーが利用するプロダクション環境においては信頼性やセキュリティはオプションではない。これらをカバーするための先行投資はよく検討すれば現実的な範囲で収めることもできる。

### ５章：最小権限を前提とする設計

- 最小権限を運用する上では、生産性とセキュリティ、信頼性のバランスを維持して取り組む必要がある
- 最小権限モデルを実装する際のベストプラクティス
  - 小さく機能的な API：API を分割してそれぞれを小さくすることで、特定のアクションに必要なパーミッションを適切に与えることができる
  - 監査：良質な監査ログの収集、監査担当者の選択。監査には大別して「ベストプラクティス遵守の確認のため」と「セキュリティ違反特定のため」の２種類がある
  - テストと最小権限：最小権限のテスト（リソースに付与される権限が必要十分か）と、最小権限でのテスト（テスト実施環境の権限が必要十分か）がある
	- 最小権限でのテストのためのテスト用インフラは小さく始めることができる：環境とクレデンシャルの分離、アクセスタイプの制限、データ露出の制限
  - アクセス拒否の診断：アクセス拒否の要因情報は攻撃者の利益となり得るので、ゼロトラストモデルを実装する初期段階では、トークンを使用し全てのクライアントにサポートチャネルを呼び出させるのが良い
  - グレースフルな障害と非常ボタン：非常ボタンを利用できる権限は厳格に管理する必要がある。その使用の監視も必要となる。
- API へのアクセス制御方法を決定するには、認証と認可が必要になる
- 認可ポリシーは、アプリケーションのバイナリとは独立して更新するのが良い。その際にはアプリケーションの開発者とセキュリティエンジニア・SRE が連携するのが推奨される
- マルチパーティ認可では、間違いの防止や攻撃コストの増加など多くの恩恵がある。一方で要求を拒否するのが精神的に難しい場合は、事後のセキュリティチームへエスカレーションしたり、一部を独立して監査するなどの方法が取れる。
- 最小権限のアクセスモデルは組織のセキュリティ改善に大きく貢献する一方で、実装には一定のコストがかかる。
  - セキュリティ要件として、「あるユーザーはどのサービスやデータにアクセスできるか」などの質問に常に答えられる必要がある
  - 情報の透明性、オープンネスとの兼ね合い
  - 開発者の複雑さを軽減するために、ガイドラインやレビューを設計する必要がある
